<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>Creature Team</title>
        <script src="js/jquery-3.6.0.min.js"></script>
        <link rel="stylesheet" href="css/home2.css"/>
    </head>
    <body>
        <div class="content">
            <canvas id="screen"></canvas>
        </div>
    </body>

    <script>
        var $container, canvasHeight, canvasWidth,canvasBoundX,canvasBoundY,isMobileDevice, creature;
        var screenCanvas = document.getElementById('screen');
        var screenCtx = this.screenCanvas.getContext('2d');

    $(document).ready(function(){
        $container = $('.content');

        resizeCanvas();
        if(isTouchDevice()){
            isMobileDevice = true;
        }

        if(isMobileDevice){
            $('body').css('padding',0);
            resizeCanvas();
        }
        

        const resizeObserver =new ResizeObserver(() => {
            resizeCanvas();
        }).observe(document.body)

        

        function resizeCanvas(){
            if($container.width() <= 480){
                $container.css({
                    height:"150%",
                    width:"150%",
                    transform:"scale(0.6666) translate(-25%, -25%)"
                });
            }else{
                var size = Math.min($container.height(), $container.width());
                $container.css({
                    height: size+"px",
                    width: size+"px",
                    transform:""
                });
            }
            canvasHeight = $container.height();
            canvasWidth = $container.width();
            canvasBoundX = canvasWidth - 60;
            canvasBoundY = canvasHeight - 60;


            screenCanvas.height = canvasHeight;
            screenCanvas.width = canvasWidth;
        }



        var grassList = [];
        
        var creatureList = [];

        var textList = [];

        var isMouseOnCreature = false;
        var activeCreatureIndex = -1;

        var mouseX = 0;
        var mouseY = 0;

        waves = [];
        var frequency = 0.1;
        var amplitude = 0.8;
        for(let i = 0; i < 32; i++){
            
            var angle = 360*Math.random();
            
            waves.push(
                {
                    frequency: frequency,
                    speed: 12*Math.random() + 6,
                    amplitude: amplitude,
                    directionX: Math.cos(angle),
                    directionY: Math.sin(angle)
                },
            )
            frequency = frequency*1.18;
            amplitude = amplitude*0.78;
        }


        var timeCount = 0;
        //creature player
        function playWave(frameTime){
            var drawStart = Date.now();
            deltaTime = (drawStart - frameTime)/1000;
            timeCount += deltaTime*1;

            screenCtx.clearRect(0, 0, screenCtx.canvas.width, screenCtx.canvas.height);
            //rows
            for(var i = 0; i < screenCanvas.height/8; i++){
                for(var ii = 0; ii < screenCanvas.width/8; ii++){

                    var lum = 0;
                    var totalAmplitude = 0;
                    for(let iii = 0; iii < waves.length; iii++){
                        var deriv = 0
                        if(iii > 0) deriv = waveDeriv(waves[iii-1], waves[iii-1].directionX*ii + waves[iii-1].directionY*i, timeCount);
                        lum += calculateWave(waves[iii], waves[iii].directionX*(ii+deriv) + waves[iii].directionY*(i+deriv), timeCount, 0);
                        totalAmplitude += waves[iii].amplitude;
                    }

                    lum = Math.round((lum/totalAmplitude + 0.5)*128); 
                    

                    drawPixel(ii*8, i*8,lum/2,lum/2,lum);
                }
            }

                window.requestAnimationFrame(function(){
                    playWave(drawStart);
                });
        }

        function calculateWave(wave, x, time, offset){
            return wave.amplitude*(Math.pow(Math.E,Math.sin((x * wave.frequency) + (time * wave.speed * wave.frequency))) - 1);
        }

        function waveDeriv(wave, x, time){
            return wave.frequency * wave.amplitude * (Math.pow(Math.E,Math.sin((x * wave.frequency) + (time * wave.speed * wave.frequency))) - 1) * Math.cos((x * wave.frequency) + (time * wave.speed * wave.frequency)) ;
        }

        function drawPixel(x,y,r,g,b,a){
            screenCtx.fillStyle = "rgb("+r+","+g+","+b+")";
            screenCtx.fillRect( x, y, 8, 8);
        }


        function beginWave(){
            window.requestAnimationFrame(function(){
                playWave(Date.now());
            });
        }

        
        

        function isTouchDevice() {
            return (('ontouchstart' in window) || (navigator.maxTouchPoints > 0) || (navigator.msMaxTouchPoints > 0));
        }

        //start playing
        beginWave();
    });
    </script>
</html>